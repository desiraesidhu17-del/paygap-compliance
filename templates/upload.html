<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Upload Payroll File</title>

  <!-- Bootstrap 5 -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />

  <!-- Your styles (loads after Bootstrap so it can override) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <style>
    body { background-color: #f6f7fb; }
    .page-wrap { max-width: 980px; }
    .card { border: 0; box-shadow: 0 2px 12px rgba(0,0,0,.06); }
  </style>
</head>
<body>
  <div class="container page-wrap py-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-3">
          {% for category, message in messages %}
            <div class="alert alert-{{ 'danger' if category=='error' else category }} mb-2" role="alert">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="card">
      <div class="card-body p-4 p-md-5">
        <h1 class="h3 mb-3">Upload your payroll file</h1>
        <p class="text-muted mb-4">
          Exports from ADP, Dayforce, and Payworks work. We’ll auto-detect columns.
        </p>

        <!-- File type -->
        <div class="mb-4">
          <label class="form-label d-block fw-semibold">Which type of file?</label>

          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="mode" id="modeTotals" value="totals" form="uploadForm" checked>
            <label class="form-check-label" for="modeTotals">
              Annual Totals <small class="text-muted">(one row per employee)</small>
            </label>
          </div>

          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="mode" id="modeLedger" value="ledger" form="uploadForm">
            <label class="form-check-label" for="modeLedger">
              Payroll Ledger <small class="text-muted">(many rows per employee with earning codes)</small>
            </label>
          </div>

          <div class="form-text">
            If your file has columns like <code>PayDate</code> and <code>EarningCode</code>,
            choose Payroll Ledger — we’ll convert it.
          </div>
        </div>

        <!-- Form -->
        <form id="uploadForm" action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data" novalidate>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="legal_name" class="form-label">Legal name</label>
              <input type="text" class="form-control" id="legal_name" name="legal_name" placeholder="DemoCo Ltd.">
            </div>
            <div class="col-md-6">
              <label for="trade_name" class="form-label">Trade name</label>
              <input type="text" class="form-control" id="trade_name" name="trade_name" placeholder="DemoCo">
            </div>

            <div class="col-md-6">
              <label for="naics" class="form-label">NAICS</label>
              <input type="text" class="form-control" id="naics" name="naics" placeholder="5415" inputmode="numeric">
            </div>
            <div class="col-md-6">
              <label for="employees" class="form-label">Employees (BC)</label>
              <input type="number" class="form-control" id="employees" name="employees" min="0" placeholder="30">
            </div>

            <div class="col-md-6">
              <label for="contact" class="form-label">Contact</label>
              <input type="email" class="form-control" id="contact" name="contact" placeholder="you@company.com">
            </div>
            <div class="col-md-6">
              <label for="year" class="form-label">Year</label>
              <input type="number" class="form-control" id="year" name="year"
                     value="{{ current_year }}" placeholder="{{ current_year }}">
            </div>

            <div class="col-md-6">
              <label for="start_date" class="form-label">Start date</label>
              <input type="date" class="form-control" id="start_date" name="start_date" value="">
            </div>
            <div class="col-md-6">
              <label for="end_date" class="form-label">End date</label>
              <input type="date" class="form-control" id="end_date" name="end_date" value="">
            </div>

            <div class="col-md-6">
              <label for="reference_gender" class="form-label">Reference gender (for gap %)</label>
              <select id="reference_gender" name="reference_gender" class="form-select">
                <option value="Man" selected>Man (reference)</option>
                <option value="Woman">Woman</option>
                <option value="Non-binary, Two-Spirit, gender diverse">Non-binary, Two-Spirit, gender diverse</option>
              </select>
            </div>

            <div class="col-md-6">
              <label for="file" class="form-label">Payroll file (CSV or Excel)</label>
              <input class="form-control" type="file" id="file" name="file" accept=".csv,.xlsx,.xls" required>
              <div class="form-text">
                We auto-detect headers like Hourly, OT Pay, Bonus, Gender, etc.
              </div>
            </div>
          </div>

          <div class="d-flex gap-2 mt-4">
            <button type="submit" class="btn btn-primary">Upload &amp; Continue</button>
            <a class="btn btn-outline-secondary" href="{{ url_for('download_template_csv') }}">
              Download CSV template
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous"></script>
</body>
</html>
