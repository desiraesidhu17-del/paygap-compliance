<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>
    {{ report.trade_name or report.legal_name or "Employer" }} — Pay Transparency Report ({{ report.year or "—" }})
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <style>
    :root{
      --ink:#0f172a; --muted:#475569; --sub:#334155; --line:#e2e8f0; --bg:#ffffff;
      --shade:#f8fafc; --accent:#0ea5e9; --accent-ink:#075985;
    }
    *{ box-sizing:border-box }
    html,body{ margin:0; padding:0; color:var(--ink); background:var(--bg);
      font:14px/1.6 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; }
    .container{ max-width:980px; margin:32px auto; padding:0 20px }

    header.report-header{
      display:flex; align-items:flex-start; justify-content:space-between; gap:16px;
      border-bottom:1px solid var(--line); padding-bottom:14px; margin-bottom:18px;
    }
    .brand{ display:flex; gap:12px; align-items:center }
    .brand .logo{ width:44px; height:44px; border-radius:10px;
      background:linear-gradient(135deg,var(--accent),#38bdf8); }
    h1{ font-size:22px; margin:0 0 4px }
    .meta{ color:var(--muted); font-size:12px; word-break:anywhere }

    .toolbar{ display:flex; gap:8px; flex-wrap:wrap }
    .btn{ appearance:none; border:1px solid var(--line); background:#fff;
      padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600;
      text-decoration:none; color:var(--ink); }
    .btn.primary{ background:var(--accent); color:#fff; border-color:transparent }

    .section{ margin:18px 0 }
    .card{ border:1px solid var(--line); border-radius:12px; background:#fff; overflow:hidden }
    .card-hd{ padding:12px 16px; border-bottom:1px solid var(--line); background:var(--shade); font-weight:700; color:var(--sub) }
    .card-bd{ padding:12px 16px }
    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px 16px }
    @media (max-width:720px){ .grid{ grid-template-columns:1fr } }
    .kv{ display:flex; gap:8px }
    .kv .k{ color:var(--muted); width:45% }
    .kv .v{ width:55% }
    .note,.caption{ color:var(--muted); font-size:12px; margin-top:6px }

    .table-wrap{ overflow:auto }
    table.gov, table.dataframe{
      width:100%; border-collapse:collapse; font-size:13px; background:#fff;
      border:1px solid var(--line); border-radius:12px; overflow:visible; table-layout:fixed;
    }
    table.gov thead th, table.dataframe thead th{
      background:var(--shade); text-align:left; padding:12px 14px; border-bottom:1px solid var(--line);
      font-weight:700;
      /* prevent mid-word breaks like 'medi-an' */
      white-space:nowrap; hyphens:none; word-break:normal; overflow-wrap:normal;
    }
    table.gov tbody td, table.dataframe tbody td{ padding:10px 12px; border-bottom:1px solid var(--line); white-space:normal; vertical-align:top; }
    table.gov tbody tr:last-child td, table.dataframe tbody tr:last-child td{ border-bottom:none }
    table.gov th:first-child, table.gov td:first-child,
    table.dataframe th:first-child, table.dataframe td:first-child{ font-weight:600 }
    table.gov .num, table.dataframe .num{ display:inline-block; min-width:4ch; text-align:right; }
    table.gov .suppressed-dash, table.dataframe .suppressed-dash{ display:inline-block; min-width:4ch; text-align:center; }
    .suppressed{ color:var(--muted); font-style:italic }

    @page{ size:A4; margin:14mm }
    @media print{
      :root{ -webkit-print-color-adjust:exact; print-color-adjust:exact }
      body{ font-size:11px }
      .container{ margin:0 auto; padding:0 }
      .toolbar, .no-print{ display:none!important }
      header.report-header{ border:none; margin:0 0 6px 0; padding:0 0 6px 0 }
      table.gov thead, table.dataframe thead{ display:table-header-group }
      table.gov tfoot, table.dataframe tfoot{ display:table-footer-group }
      table.gov thead th, table.dataframe thead th{ padding:10px 10px }
      table.gov tbody td, table.dataframe tbody td{ padding:8px 10px }
      .table-wrap{ overflow:visible !important }
      table.gov tr, table.dataframe tr{ break-inside:avoid; page-break-inside:avoid; }
      table.gov .num, table.dataframe .num{ min-width:3.2ch }
      table.gov .suppressed-dash, table.dataframe .suppressed-dash{ min-width:3.2ch; text-align:center; }
      .card{ break-inside:auto; page-break-inside:auto }
    }

    .empty{ border:1px dashed var(--line); border-radius:10px; padding:10px 12px; color:var(--muted); background:#fafcff; }
  </style>
</head>

<body>
<div class="container">

  {% set is_clean = (mode or 'clean') == 'clean' %}
  {% set is_admin = is_admin or False %}

  <header class="report-header">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>British Columbia • Pay Transparency Report</h1>
        <div class="meta">
          {{ report.trade_name or report.legal_name or 'Employer' }}
          • Reporting period: {{ report.start_date or '—' }} to {{ report.end_date or '—' }}
          • Posted: {{ report.posted or '—' }}
          {% if report.contact %} • Contact: {{ report.contact }}{% endif %}
        </div>
      </div>
    </div>

    <div class="toolbar">
      <button class="btn" onclick="window.print()">Print / Save as PDF</button>
      <a class="btn {% if not is_clean %}primary{% endif %}" href="{{ url_for('report', report_id=report.id, mode='transparent') }}">Transparent (internal)</a>
      <a class="btn {% if is_clean %}primary{% endif %}" href="{{ url_for('report', report_id=report.id, mode='clean') }}">Clean (public)</a>
      <a class="btn" href="{{ url_for('download_pdf', report_id=report.id, mode=mode) }}">Download Official PDF</a>
      <form method="POST" action="{{ url_for('publish') }}"><input type="hidden" name="report_id" value="{{ report.id }}"><button class="btn" type="submit">Publish</button></form>
    </div>
  </header>

  {% if report.public_url %}
    <div class="note" style="margin:-6px 0 10px 0">
      Published PDF: <a href="{{ report.public_url }}" target="_blank" rel="noopener">{{ report.public_url }}</a>
    </div>
  {% endif %}

  <section class="section">
    <div class="card" role="region" aria-labelledby="employer-info-h">
      <div class="card-hd" id="employer-info-h">Employer information</div>
      <div class="card-bd">
        <div class="grid">
          <div class="kv"><div class="k">Legal name</div><div class="v">{{ report.legal_name or '—' }}</div></div>
          <div class="kv"><div class="k">Trade name</div><div class="v">{{ report.trade_name or '—' }}</div></div>
          <div class="kv"><div class="k">Mailing address</div><div class="v">{{ report.mailing_address or '—' }}</div></div>
          <div class="kv"><div class="k">Industry (NAICS)</div><div class="v">{{ report.naics or '—' }}</div></div>
          <div class="kv"><div class="k">Employees in B.C. (Jan 1)</div><div class="v">{{ report.bc_headcount_range or '—' }}</div></div>
          <div class="kv"><div class="k">Reference gender for gaps</div><div class="v">{{ report.reference_gender or 'Man' }}</div></div>
          <div class="kv"><div class="k">Contact</div><div class="v">{{ report.contact or '—' }}</div></div>
        </div>
        <p class="note">Categories with fewer than 10 individuals are suppressed to comply with B.C. Pay Transparency rules.</p>
      </div>
    </div>
  </section>

  {% macro table_block(title, html_table, empty_text='', show_caption=True) -%}
    <section class="section" role="region" aria-labelledby="{{ title|replace(' ', '-')|lower }}-h">
      <div class="card">
        <div class="card-hd" id="{{ title|replace(' ', '-')|lower }}-h">{{ title }}</div>
        <div class="card-bd">
          <div class="table-wrap">
            {% if html_table %}
              {{ html_table|safe }}
            {% else %}
              <div class="empty">{{ empty_text or "No data available for this section in the reporting period." }}</div>
            {% endif %}
          </div>
          {% if show_caption %}
            <p class="caption">
              Categories with fewer than 10 individuals are suppressed.
              {% if (mode or 'clean') == 'clean' %}
                Quartile distributions for suppressed categories are collapsed into a single “Suppressed (n&lt;10)” row.
              {% else %}
                Quartile distributions for suppressed categories are hidden in this view.
              {% endif %}
              Percentages may not total 100% due to rounding.
            </p>
          {% endif %}
        </div>
      </div>
    </section>
  {%- endmacro %}

  <!-- Order emphasizes core pay sections up front -->
  {{ table_block("Employee gender distribution (B.C.)", gender_table, empty_text="No employees included in the reporting population.", show_caption=False) }}
  {{ table_block("Hourly pay", hourly_table, empty_text="Hourly pay data could not be calculated from your file.") }}
  {{ table_block("Overtime pay", overtime_pay, empty_text="No overtime pay was reported for the period.") }}
  {{ table_block("Bonus pay", bonus_table, empty_text="No bonus or incentive pay was reported for the period.") }}
  {{ table_block("Proportion receiving bonus pay", participation_table, empty_text="No employees with bonus or incentive pay in the period.") }}
  {{ table_block("Proportion of employees in each pay quartile by gender", quartiles_table, empty_text="Not enough pay data to calculate quartiles (need at least 4 valid hourly pay values).") }}

  <footer class="note" style="margin:18px 0">
    Report ID: {{ report.id or '—' }} •
    Company: {{ report.trade_name or report.legal_name or '—' }} •
    Year: {{ report.year or '—' }}
  </footer>
</div>
</body>
</html>
